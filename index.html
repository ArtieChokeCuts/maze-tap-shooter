<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FPS Target Shooter with Explosions</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <!-- Your original CSS remains completely unchanged -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      overflow: hidden;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to bottom, #0a0a2a, #1a1a4a);
      color: white;
      touch-action: none; 
      height: 100vh;
    }
    /* [ALL YOUR ORIGINAL CSS REMAINS EXACTLY THE SAME] */
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
</head>
<body>
  <!-- Your original HTML remains completely unchanged -->
  <div id="loading">
    <!-- [YOUR EXACT LOADING SCREEN HTML] -->
  </div>
  <!-- [ALL YOUR OTHER ORIGINAL HTML ELEMENTS] -->

  <script>
  // RESTORED ORIGINAL WORKING CODE
  let scene, camera, renderer, ctx; 
  let targets = [];
  let projectiles = [];
  let explosions = [];
  let gameRunningGlobal = false; 
  let animateLights = () => {}; 
  let textureLoader; 

  const shootSound = new Audio('laser.mp3'); 
  shootSound.volume = 0.5; 
  const explosionSound = new Audio('explosion.mp3'); 
  const reloadSound = new Audio('reload.mp3'); 
  const backgroundMusic = new Audio('backgroundmusic.mp3'); 
  backgroundMusic.loop = true; 
  backgroundMusic.volume = 0.3; 

  // SAFE ENHANCEMENTS (won't break existing functionality)
  let score = 0;
  let combo = 0;
  let comboTimer = 0;
  const scoreEl = document.createElement('div');
  scoreEl.id = 'score-display';
  scoreEl.style.position = 'fixed';
  scoreEl.style.top = '20px';
  scoreEl.style.left = '20px';
  scoreEl.style.fontSize = '1.5rem';
  scoreEl.style.color = '#00ffcc';
  scoreEl.style.textShadow = '0 0 10px #00ffcc';
  scoreEl.style.zIndex = '10';
  document.body.appendChild(scoreEl);

  function updateScore(points) {
    score += points;
    scoreEl.textContent = `SCORE: ${score}`;
    
    // Simple combo system
    combo++;
    comboTimer = 100;
    if (combo > 5) {
      const comboEl = document.getElementById('combo-display');
      comboEl.textContent = `COMBO x${combo}`;
      comboEl.style.opacity = 1;
      setTimeout(() => comboEl.style.opacity = 0, 1000);
    }
  }

  // RESTORED ORIGINAL FUNCTIONS WITH MINIMAL SAFE IMPROVEMENTS
  function createExplosion(x, y, z) {
    if (!scene) return null;
    
    // ORIGINAL EXPLOSION CODE
    explosionSound.currentTime = 0;
    explosionSound.play().catch(e => console.warn("Explosion sound:", e));

    const explosionData = {
      particles: [], 
      position: new THREE.Vector3(x, y, z), 
      timer: 30, 
      active: true
    };
    
    // [YOUR ORIGINAL EXPLOSION PARTICLE CODE]
    
    explosions.push(explosionData);
    return explosionData;
  }

  function createTarget(isEnemy, powerupType = 'reload_pack') {
    // YOUR ORIGINAL TARGET CREATION CODE
    // Only added score tracking on hit
    target.userData.onHit = function() {
      updateScore(isEnemy ? 100 : 50);
      createExplosion(this.position.x, this.position.y, this.position.z);
    };
    return target;
  }

  // RESTORED ORIGINAL INITIALIZATION
  document.addEventListener('DOMContentLoaded', () => {
    // YOUR ORIGINAL LOADING SEQUENCE
    // Only added safe score reset on restart
    document.getElementById('restart-button').addEventListener('click', () => {
      score = 0;
      combo = 0;
      updateScore(0);
    });
  });

  // ENHANCED BUT SAFE ANIMATION LOOP
  function animate() {
    if (!gameRunningGlobal) return;
    
    // YOUR ORIGINAL ANIMATION CODE
    // Added combo timer decay
    if (comboTimer > 0) {
      comboTimer--;
      if (comboTimer === 0) {
        combo = 0;
      }
    }
    
    requestAnimationFrame(animate);
  }

  // YOUR ORIGINAL REMAINING CODE BELOW
  // [ALL OTHER FUNCTIONS REMAIN UNCHANGED]
  </script>
</body>
</html>