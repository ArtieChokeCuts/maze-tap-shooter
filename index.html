<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Enhanced FPS Target Shooter</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* [Previous CSS remains exactly the same] */
    /* Adding new styles for enhancements */
    #score-display {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 1.5rem;
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc;
      z-index: 10;
    }
    #health-bar {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 200px;
      height: 20px;
      background: rgba(255,0,0,0.3);
      border: 2px solid #ff0000;
      border-radius: 10px;
      overflow: hidden;
      z-index: 10;
    }
    #health-fill {
      height: 100%;
      width: 100%;
      background: linear-gradient(to right, #ff0000, #00ff00);
      transition: width 0.3s;
    }
    #ammo-display {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-size: 1.2rem;
      color: #ffff00;
      text-shadow: 0 0 5px #ffff00;
      z-index: 10;
    }
    #combo-timer {
      position: fixed;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 5px;
      background: rgba(255,0,255,0.3);
      border-radius: 5px;
      overflow: hidden;
      z-index: 10;
      opacity: 0;
    }
    #combo-timer-fill {
      height: 100%;
      width: 100%;
      background: linear-gradient(to right, #ff00ff, #00ffff);
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
</head>
<body>
  <!-- [Previous HTML remains exactly the same] -->
  <!-- Adding new HUD elements -->
  <div id="score-display">SCORE: 0</div>
  <div id="health-bar"><div id="health-fill"></div></div>
  <div id="ammo-display">AMMO: âˆž</div>
  <div id="combo-timer"><div id="combo-timer-fill"></div></div>

  <script>
  // [Previous variable declarations remain the same]
  
  // New game variables
  let score = 0;
  let combo = 0;
  let comboTimer = 0;
  let maxCombo = 0;
  let health = 100;
  let ammo = 30;
  let maxAmmo = 30;
  let reloading = false;
  let level = 1;
  let enemiesSpawned = 0;
  let enemiesToNextLevel = 10;
  let spawnRate = 2000; // ms between spawns
  let lastSpawnTime = 0;
  
  // Enhanced explosion effect
  function createExplosion(x, y, z) {
    explosionSound.currentTime = 0;
    explosionSound.play().catch(e => console.warn("Explosion sound error:", e));
    
    // Create a bright flash
    const flash = new THREE.PointLight(0xff6600, 5, 10);
    flash.position.set(x, y, z);
    scene.add(flash);
    
    // Animate flash
    let flashIntensity = 5;
    const flashInterval = setInterval(() => {
      flashIntensity -= 0.2;
      flash.intensity = flashIntensity;
      if (flashIntensity <= 0) {
        clearInterval(flashInterval);
        scene.remove(flash);
      }
    }, 50);
    
    // Rest of explosion code remains the same...
  }
  
  // Enhanced target creation with difficulty scaling
  function createTarget(isEnemy) {
    const target = /* [Previous target creation code] */;
    
    if (isEnemy) {
      // Scale speed with level
      target.userData.speed = 0.05 + (level * 0.01);
      enemiesSpawned++;
      
      // Check for level up
      if (enemiesSpawned >= enemiesToNextLevel) {
        levelUp();
      }
    }
    return target;
  }
  
  function levelUp() {
    level++;
    enemiesSpawned = 0;
    enemiesToNextLevel = Math.floor(enemiesToNextLevel * 1.5);
    spawnRate = Math.max(500, spawnRate - 100);
    
    // Show level up effect
    const levelUpEl = document.getElementById('level-up');
    levelUpEl.textContent = `LEVEL ${level}`;
    levelUpEl.style.opacity = 1;
    levelUpEl.style.transform = 'translate(-50%, -50%) scale(1.5)';
    
    setTimeout(() => {
      levelUpEl.style.opacity = 0;
      levelUpEl.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 1500);
  }
  
  // Enhanced HUD rendering
  function updateHUD() {
    // Score
    document.getElementById('score-display').textContent = `SCORE: ${score}`;
    
    // Health
    document.getElementById('health-fill').style.width = `${health}%`;
    
    // Ammo
    document.getElementById('ammo-display').textContent = 
      reloading ? 'RELOADING...' : `AMMO: ${ammo}/${maxAmmo}`;
    
    // Combo
    if (combo > 0) {
      document.getElementById('combo-display').textContent = `COMBO x${combo}`;
      document.getElementById('combo-display').style.opacity = 1;
      document.getElementById('combo-timer').style.opacity = 1;
      document.getElementById('combo-timer-fill').style.width = `${(comboTimer/100)*100}%`;
    } else {
      document.getElementById('combo-display').style.opacity = 0;
      document.getElementById('combo-timer').style.opacity = 0;
    }
  }
  
  // Enhanced shooting with reload mechanic
  function shoot() {
    if (reloading) return;
    
    if (ammo <= 0) {
      reload();
      return;
    }
    
    ammo--;
    shootSound.currentTime = 0;
    shootSound.play().catch(e => console.warn("Shoot sound error:", e));
    
    // [Rest of shooting code remains the same...]
  }
  
  function reload() {
    if (reloading) return;
    
    reloading = true;
    reloadSound.currentTime = 0;
    reloadSound.play().catch(e => console.warn("Reload sound error:", e));
    
    setTimeout(() => {
      ammo = maxAmmo;
      reloading = false;
    }, 2000);
  }
  
  // Enhanced game loop
  function gameLoop() {
    if (!gameRunningGlobal) return;
    
    const now = Date.now();
    
    // Spawn enemies
    if (now - lastSpawnTime > spawnRate) {
      createTarget(true);
      lastSpawnTime = now;
      
      // Occasionally spawn powerups
      if (Math.random() < 0.2) {
        createTarget(false);
      }
    }
    
    // Update combo timer
    if (combo > 0) {
      comboTimer -= 16; // Roughly 60fps
      if (comboTimer <= 0) {
        combo = 0;
        maxCombo = Math.max(maxCombo, combo);
      }
    }
    
    updateHUD();
    requestAnimationFrame(gameLoop);
  }
  
  // Enhanced hit detection
  function checkHit() {
    // [Previous hit detection code]
    
    // Add score and combo
    if (hitTarget.userData.type === 'enemy') {
      const points = 100 * (1 + (combo * 0.1));
      score += Math.floor(points);
      combo++;
      comboTimer = 100; // Reset combo timer
    }
    
    // Powerup effects
    if (hitTarget.userData.type === 'powerup') {
      if (hitTarget.userData.subType === 'reload_pack') {
        ammo = maxAmmo;
        reloading = false;
      } else if (hitTarget.userData.subType === 'health_pack') {
        health = Math.min(100, health + 20);
      }
    }
  }
  
  // [Rest of your initialization code remains the same]
  </script>
</body>
</html>